<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Agent V4.1 - AI Tools</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #121212; color: #e0e0e0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: #1f1f1f; padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); }
        h1 { color: #bb86fc; text-align: center; margin-bottom: 30px; }
        .tool-selector { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 30px; }
        .tool-selector button { padding: 10px 20px; background-color: #3700b3; color: white; border: none; border-radius: 6px; cursor: pointer; transition: background-color 0.3s; font-weight: bold; }
        .tool-selector button:hover { background-color: #6200ee; }
        .tool-selector button.active { background-color: #03dac6; color: #121212; }
        .input-group, .email-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #03dac6; font-weight: bold; }
        textarea, input[type="email"] { width: 100%; padding: 12px; border: 1px solid #333; border-radius: 6px; background-color: #2c2c2c; color: white; resize: vertical; box-sizing: border-box; font-size: 16px; }
        .button-group { text-align: center; }
        .button-group button { padding: 12px 25px; background-color: #03dac6; color: #121212; border: none; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; transition: background-color 0.3s; }
        .button-group button:hover { background-color: #01a398; }
        .output-box { background-color: #2c2c2c; padding: 15px; border-radius: 6px; min-height: 100px; margin-top: 25px; white-space: pre-wrap; word-wrap: break-word; border: 1px solid #333; }
        .loading { text-align: center; color: #bb86fc; font-weight: bold; margin-top: 15px; display: none; }
        .error { color: #cf6679; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h1>Master Agent AI V4.1</h1>

    <div class="tool-selector" id="toolSelector">
        <button data-tool="Tool 1: SEO Title" class="active">1. SEO/Content</button>
        <button data-tool="Tool 2: Summary">2. Tóm tắt</button>
        <button data-tool="Tool 3: Rephrase">3. Viết lại</button>
        <button data-tool="Tool 4: Zodiac">4. Tử Vi</button>
        <button data-tool="Tool 5: Tarot Reading">5. Đọc Tarot</button>
        <button data-tool="Tool 6: XMAS Wishes">6. Lời Chúc</button>
    </div>

    <div class="input-group">
        <label for="prompt">Nhập nội dung/yêu cầu:</label>
        <textarea id="prompt" rows="8" placeholder="Dán nội dung cần xử lý hoặc nhập câu hỏi (Tối đa 2000 ký tự)"></textarea>
    </div>

    <div class="email-group">
        <label for="email">Email nhận thông báo/kết quả (Bắt buộc):</label>
        <input type="email" id="email" placeholder="email@example.com" required>
    </div>

    <div class="button-group">
        <button id="generateBtn">Tạo Kết Quả</button>
    </div>

    <div class="loading" id="loadingDiv">Đang xử lý bởi Agent... Vui lòng chờ 5-15 giây</div>

    <div class="output-box" id="resultBox">Kết quả sẽ hiển thị ở đây.</div>
</div>

<script>
    // ------------------------------------------------------------------------------------------------------------------------------------------
    // CẤU HÌNH APPS SCRIPT URL: ĐÃ GẮN URL BOT KÝ ỨC MỚI NHẤT VÀ CHÍNH XÁC
    // ------------------------------------------------------------------------------------------------------------------------------------------
    const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby9EBXTCA2UaQxWc4HZL-ovaQRE5hFi69FZS8N0P5Wf69sVTUWBv2AOtvY84ZHinakG/exec';

    const generateBtn = document.getElementById('generateBtn');
    const promptInput = document.getElementById('prompt');
    const emailInput = document.getElementById('email');
    const resultBox = document.getElementById('resultBox');
    const loadingDiv = document.getElementById('loadingDiv');
    const toolSelector = document.getElementById('toolSelector');
    let currentTool = "Tool 1: SEO Title"; // Mặc định

    // Lưu thông tin vào Apps Script (Bot Ký Ức)
    async function logData(email, tool, title) {
        try {
            await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify({ email, tool, title }),
                headers: { 'Content-Type': 'application/json' }
            });
        } catch (e) {
            console.error('Lỗi log data:', e);
            // Không cần thông báo lỗi cho người dùng cuối
        }
    }

    // Xử lý thay đổi công cụ
    toolSelector.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            document.querySelectorAll('.tool-selector button').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            currentTool = e.target.getAttribute('data-tool');
            resultBox.innerHTML = 'Kết quả sẽ hiển thị ở đây.';
            promptInput.placeholder = getPlaceholder(currentTool);
        }
    });

    // Cung cấp placeholder theo công cụ
    function getPlaceholder(tool) {
        switch (tool) {
            case "Tool 1: SEO Title": return "Nhập chủ đề cần tạo tiêu đề SEO (ví dụ: Bí quyết nuôi dạy con tuổi teen)";
            case "Tool 2: Summary": return "Dán bài viết cần tóm tắt (Tối đa 2000 ký tự)";
            case "Tool 3: Rephrase": return "Dán nội dung cần viết lại (Tối đa 2000 ký tự)";
            case "Tool 4: Zodiac": return "Nhập ngày/tháng/năm sinh của bạn (ví dụ: 15/05/1990)";
            case "Tool 5: Tarot Reading": return "Đặt câu hỏi về tình yêu, công việc hoặc cuộc sống (ví dụ: Tuần này tôi nên tập trung vào điều gì?)";
            case "Tool 6: XMAS Wishes": return "Nhập tên người nhận và mối quan hệ (ví dụ: Ông bà, Anh A)";
            default: return "Dán nội dung cần xử lý hoặc nhập câu hỏi (Tối đa 2000 ký tự)";
        }
    }

    // Hàm chính gọi Netlify Function
    generateBtn.addEventListener('click', async () => {
        const prompt = promptInput.value.trim();
        const email = emailInput.value.trim();

        if (!email) {
            resultBox.innerHTML = '<span class="error">Vui lòng nhập Email để nhận kết quả.</span>';
            return;
        }

        if (!prompt && currentTool !== "Tool 6: XMAS Wishes") {
            resultBox.innerHTML = '<span class="error">Vui lòng nhập nội dung/yêu cầu.</span>';
            return;
        }

        loadingDiv.style.display = 'block';
        generateBtn.disabled = true;
        resultBox.innerHTML = 'Đang gọi Agent...';

        try {
            const response = await fetch('/.netlify/functions/generate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt, tool: currentTool })
            });

            if (response.ok) {
                const data = await response.json();
                resultBox.innerHTML = data.result;
                await logData(email, currentTool, prompt.substring(0, 100) + '...');
            } else {
                resultBox.innerHTML = 'Lỗi kết nối Agent. Vui lòng thử lại sau.';
                await logData(email, currentTool, prompt.substring(0, 100) + '...');
            }
        } catch (error) {
            resultBox.innerHTML = 'Lỗi kết nối Agent. Vui lòng thử lại sau.';
            await logData(email, currentTool, prompt.substring(0, 100) + '...');
        } finally {
            loadingDiv.style.display = 'none';
            generateBtn.disabled = false;
        }
    });

    // Thiết lập placeholder ban đầu
    promptInput.placeholder = getPlaceholder(currentTool);

</script>

</body>
</html>
