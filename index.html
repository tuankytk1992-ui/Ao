<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ thống AI Tự sinh khối - 6 Công cụ (Tăng Traffic)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background-color: #f7f9fc; color: #333; margin: 0; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background-color: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); }
        h1 { color: #8e24aa; text-align: center; margin-bottom: 25px; } /* Màu Tím cho phong cách huyền bí */
        .tool-selector button { background-color: #e9ecef; color: #495057; border: none; padding: 10px 15px; margin: 5px 3px; border-radius: 8px; cursor: pointer; transition: background-color 0.3s, color 0.3s; font-weight: 600; font-size: 14px; }
        .tool-selector button.active { background-color: #8e24aa; color: white; box-shadow: 0 4px 8px rgba(142, 36, 170, 0.3); }
        .tool-selector { text-align: center; margin-bottom: 25px; }
        textarea, input[type="email"] { width: 100%; padding: 15px; margin-bottom: 20px; border: 1px solid #ced4da; border-radius: 8px; box-sizing: border-box; font-size: 16px; transition: border-color 0.3s; }
        textarea:focus, input[type="email"]:focus { border-color: #8e24aa; outline: none; }
        button#generateBtn { background-color: #ff9800; color: white; padding: 15px 25px; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold; transition: background-color 0.3s; width: 100%; }
        button#generateBtn:hover { background-color: #fb8c00; }
        .result-box { margin-top: 25px; padding: 20px; background-color: #fce4ec; border-radius: 8px; border: 1px solid #f8bbd0; white-space: pre-wrap; word-wrap: break-word; min-height: 100px; }
        .loading { text-align: center; padding: 20px; font-weight: 600; color: #8e24aa; }
        .ad-placeholder { background-color: #ccc; height: 90px; line-height: 90px; text-align: center; color: #666; font-size: 14px; margin-bottom: 20px; border-radius: 8px; }
        .affiliate-notice { background-color: #e0f7fa; border: 1px solid #b2ebf2; padding: 10px; margin-top: 15px; border-radius: 8px; font-size: 14px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Hệ thống Tự sinh khối AI - 6 Công cụ (Ký Ức Bot Đã Kích Hoạt)</h1>
        
        <div class="ad-placeholder" id="top-ad">Mã Quảng cáo (CPC/CPM) sẽ hiển thị ở đây.</div>

        <div class="tool-selector" id="toolSelector">
            <button data-tool="TITLE_AI" class="active">Tạo Tiêu đề SEO</button>
            <button data-tool="SUMMARY_AI">Tóm tắt Văn bản</button>
            <button data-tool="REPHRASE_AI">Viết lại Câu</button>

            <button data-tool="ZODIAC_ANALYSIS">Phân tích Tử Vi</button>
            <button data-tool="TAROT_READING">Giải mã Vận số</button>
            <button data-tool="CHRISTMAS_WISH">Thông điệp Giáng Sinh</button>
        </div>

        <textarea id="promptInput" rows="6" placeholder="Nhập từ khóa, đoạn văn, cung hoàng đạo, hoặc câu hỏi của bạn vào đây..."></textarea>
        
        <input type="email" id="emailInput" placeholder="Nhập Email để nhận kết quả và mở khóa tính năng (Bắt buộc)">

        <button id="generateBtn">Tạo Nội dung AI Huyền Bí</button>

        <div id="loading" class="loading" style="display:none;">Đang tạo nội dung, xin chờ... Vận số đang được giải mã!</div>
        
        <div class="result-box" id="resultBox">Kết quả AI sẽ hiển thị ở đây.</div>
        
        <div class="affiliate-notice">
            Muốn nội dung của bạn đạt đến sự hoàn hảo? Hãy sử dụng công cụ tối ưu hóa nội dung hàng đầu: 
            <a href="https://affiliate-link-cua-ban.com" target="_blank">Surfer SEO</a>.
        </div>
    </div>

    <script>
        // Bot 2: Memory Agent (Apps Script URL của Chủ nhân)
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwZX6LDD03R41ZHUKtnlrLOKavBLNCizwMpC1eS3UeTMD7kIAXqniXiVsoKWGtq7zg0/exec';
        
        let currentTool = 'TITLE_AI';
        const generateBtn = document.getElementById('generateBtn');
        const promptInput = document.getElementById('promptInput');
        const emailInput = document.getElementById('emailInput');
        const resultBox = document.getElementById('resultBox');
        const loadingDiv = document.getElementById('loading');
        const toolSelector = document.getElementById('toolSelector');

        toolSelector.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                document.querySelectorAll('.tool-selector button').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                currentTool = e.target.getAttribute('data-tool');
                promptInput.placeholder = getPlaceholder(currentTool);
                resultBox.innerHTML = 'Kết quả AI sẽ hiển thị ở đây.';
            }
        });

        function getPlaceholder(tool) {
            switch (tool) {
                case 'TITLE_AI':
                    return 'Nhập từ khóa hoặc chủ đề bạn muốn tạo tiêu đề...';
                case 'SUMMARY_AI':
                    return 'Dán đoạn văn bản dài bạn muốn tóm tắt vào đây...';
                case 'REPHRASE_AI':
                    return 'Dán câu/đoạn văn bạn muốn viết lại để tránh đạo văn...';
                case 'ZODIAC_ANALYSIS':
                    return 'Nhập cung hoàng đạo của bạn (Ví dụ: Bảo Bình, Ma Kết,...)';
                case 'TAROT_READING':
                    return 'Đặt câu hỏi cụ thể về Tình yêu, Sự nghiệp hoặc Vận số của bạn...';
                case 'CHRISTMAS_WISH':
                    return 'Nhập tên người nhận hoặc mô tả ngắn về mối quan hệ (Ví dụ: bạn gái, đồng nghiệp thân thiết)...';
                default:
                    return 'Nhập từ khóa, đoạn văn hoặc câu của bạn vào đây...';
            }
        }
        
        // Bot 2: Memory Agent (Ghi nhận Email)
        async function logData(email, tool, status = 'NEW_LEAD') {
            try {
                await fetch(APPS_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, tool, status }),
                });
                console.log('Data logged successfully');
            } catch (error) {
                console.error('Logging Error:', error);
            }
        }

        // Bot 1: Traffic Agent (Gửi yêu cầu tạo nội dung)
        generateBtn.addEventListener('click', async () => {
            const prompt = promptInput.value.trim();
            const email = emailInput.value.trim();

            if (!prompt || !email) {
                alert('Vui lòng nhập đầy đủ nội dung và Email để sử dụng công cụ.');
                return;
            }

            loadingDiv.style.display = 'block';
            resultBox.innerHTML = '';
            generateBtn.disabled = true;

            try {
                const response = await fetch('/.netlify/functions/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt, tool: currentTool, email }),
                });

                const data = await response.json();

                if (response.ok) {
                    resultBox.innerHTML = data.result;
                    // Log data sau khi tạo nội dung thành công
                    await logData(email, currentTool, 'USED_TOOL'); 
                } else {
                    resultBox.innerHTML = `Lỗi: ${data.error || 'Không thể tạo nội dung.'}`;
                    // Log data lỗi
                    await logData(email, currentTool, 'ERROR'); 
                }

            } catch (error) {
                resultBox.innerHTML = 'Lỗi kết nối. Vui lòng kiểm tra lại mạng.';
                // Log data lỗi
                await logData(email, currentTool, 'ERROR_CONNECTION'); 
            } finally {
                loadingDiv.style.display = 'none';
                generateBtn.disabled = false;
            }
        });
        
        // Bot 6: Ad Manager (Placeholder) - Chủ nhân sẽ thay thế bằng mã quảng cáo thực tế sau
    </script>
</body>
</html>
